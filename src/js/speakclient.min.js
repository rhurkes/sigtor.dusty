function speak(text,args){function parseWav(wav){function readInt(i,bytes){for(var ret=0,shft=0;bytes;)ret+=wav[i]<<shft,shft+=8,i++,bytes--
return ret}if(1!=readInt(20,2))throw"Invalid compression code, not PCM"
if(1!=readInt(22,2))throw"Invalid number of channels, not 1"
return{sampleRate:readInt(24,4),bitsPerSample:readInt(34,2),samples:wav.subarray(44)}}function playHTMLAudioElement(wav){function encode64(data){for(var BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",PAD="=",ret="",leftchar=0,leftbits=0,i=0;i<data.length;i++)for(leftchar=leftchar<<8|data[i],leftbits+=8;leftbits>=6;){var curr=leftchar>>leftbits-6&63
leftbits-=6,ret+=BASE[curr]}return 2==leftbits?(ret+=BASE[(3&leftchar)<<4],ret+=PAD+PAD):4==leftbits&&(ret+=BASE[(15&leftchar)<<2],ret+=PAD),ret}document.getElementById("audio").innerHTML='<audio id="player" src="data:audio/x-wav;base64,'+encode64(wav)+'">',document.getElementById("player").play()}function handleWav(wav){var startTime=Date.now()
parseWav(wav),playHTMLAudioElement(wav),PROFILE&&console.log("speak.js: wav processing took "+(Date.now()-startTime).toFixed(2)+" ms")}if(void 0===speakWorker)return!1
var PROFILE=0
if(args&&args.noWorker){var startTime=Date.now(),wav=generateSpeech(text,args)
PROFILE&&console.log("speak.js: processing took "+(Date.now()-startTime).toFixed(2)+" ms"),handleWav(wav)}else{var startTime=Date.now()
speakWorker.onmessage=function(event){PROFILE&&console.log("speak.js: worker processing took "+(Date.now()-startTime).toFixed(2)+" ms"),handleWav(event.data)},speakWorker.postMessage({text:text,args:args})}}var speakWorker
try{speakWorker=new Worker("js/speakWorker.js")}catch(e){console.log("speak.js warning: no worker support")}